(()=>{"use strict";const t=Math,s=(t.PI,(t,s)=>t>s?t:s),e=(t,s)=>t<s?t:s,i=s=>t.random()*s,h=s=>t.floor(s),r=(s,e)=>t.hypot(s.x-e.x,s.y-e.y),o=(t,s)=>new Array(t).fill(s),n=localStorage,a=(t,s)=>n.setItem(t,s),c=t=>n.getItem(t),p=[{tap:1,dg:[],map:[[1,0,0,0,2]]},{tap:1,dg:[5],map:[[0,0,0,0,2],[1,0,0,0,9]]},{tap:1,dg:[5,7,5,7,5,8],map:[[1,9,0,0,0,11,2],[0,0,0,11,0,0,0]]},{tap:1,dg:[5,5,7,8],map:[[1,0,9,0,2],[0,0,0,0,9]]},{tap:2,dg:[5,7],map:[[8,0,0,11,0],[0,0,0,0,0],[0,2,0,0,0],[0,0,0,0,6],[0,11,0,1,0]]},{tap:2,dg:[7,9],map:[[0,0,0,0,8],[0,0,0,11,0],[0,0,11,2,0],[0,0,0,11,0],[0,1,0,0,0]]},{tap:2,dg:[6,6,10],map:[[8,0,0,0,0],[0,0,0,0,0],[0,0,2,9,1],[0,0,0,0,0],[7,0,0,0,0]]},{tap:2,dg:[9],map:[[0,0,11,0,0,0],[0,0,0,2,0,0],[0,1,0,0,11,0]]},{tap:3,dg:[8],map:[[0,0,10,0,0,0],[0,0,2,0,0,0],[0,0,0,0,1,0]]},{tap:3,dg:[7,9],map:[[11,11,0,0,6,0],[0,0,2,0,0,10],[0,11,10,0,0,0],[0,0,6,0,1,0]]},{tap:3,dg:[5,6,9],map:[[0,0,0,0,0,0],[0,11,0,0,11,0],[0,11,10,0,2,10],[0,11,0,0,11,0],[1,0,0,0,0,0]]},{tap:3,dg:[5,6,7,8],map:[[0,0,10,0,0],[0,11,2,11,0],[0,0,11,0,0],[0,0,0,0,0],[0,0,0,1,0]]},{tap:2,dg:[10],map:[[0,0,9,0,0,0],[0,9,2,9,3,0],[0,0,9,0,0,0],[0,0,0,0,1,0]]},{tap:4,dg:[5,3,7],map:[[0,0,0,0,0,0,0],[0,0,8,0,0,0,0],[0,11,2,9,0,0,0],[0,0,9,0,0,0,0],[0,0,0,10,0,0,1]]},{tap:4,dg:[3,7],map:[[10,4,0,10,9,0,6],[0,0,0,9,9,0,0],[0,0,11,0,1,11,0],[0,2,0,0,0,0,0],[0,11,0,0,0,0,0],[0,0,0,0,0,0,0]]},{tap:3,dg:[5,6,7],map:[[0,0,0,0,0,0,0],[0,0,0,9,2,9,0],[0,0,0,0,0,4,0],[9,0,0,0,9,0,0],[0,1,0,0,0,0,0],[0,0,0,11,0,3,11]]},{tap:8,dg:[4,7,10],map:[[0,0,0,0,0,0,0,0,0,0],[0,1,0,9,0,0,0,6,6,6],[0,0,0,0,0,10,0,0,9,0],[0,0,3,0,7,0,0,9,2,0],[0,0,0,0,0,0,0,0,9,0]]},{tap:6,dg:[7],map:[[10,0,0,0,0,0,0,0,0],[0,0,0,9,9,9,0,0,0],[1,0,11,5,2,6,11,0,0],[0,0,0,9,9,9,0,0,0],[0,4,0,0,0,0,0,3,0],[0,0,0,0,0,10,0,0,10]]},{tap:10,dg:[],map:[[0,0,0,0,0,9,0,4,0,0],[0,0,9,0,0,0,0,0,0,0],[0,0,0,0,1,0,9,0,0,0],[0,2,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,9,0,0]]},{tap:8,dg:[7],map:[[0,0,9,0,0,0,0,0,4,0],[0,2,0,0,0,0,9,0,0,0],[0,0,3,0,0,9,9,0,0,0],[0,9,0,0,0,0,9,0,1,0],[0,0,0,0,9,0,0,0,0,0]]},{tap:15,dg:[8],map:[[0,0,0,0,0,0,0,1,0],[0,0,0,3,0,0,0,0,0],[9,9,9,0,0,9,9,9,9],[0,0,9,0,0,0,11,0,9],[0,2,9,0,0,0,9,9,9],[0,0,9,0,4,0,0,11,9],[11,0,9,10,0,9,9,9,9]]}],l=document,d=t=>t.getContext("2d"),u=t=>new Image,m=t=>t.toDataURL(),g=l.getElementById("canvas");const w=d(g),y=(t,s)=>{t&&w.drawImage(t,s.x,s.y,s.w,s.h)},x=t=>w.globalAlpha=t,f=t=>w.fillStyle="#"+t,v=t=>w.save(),b=t=>w.restore(),M=[0,0,0],I=[0,1,0],T=[1,0,0],k=[0,0,1],O="333",E="065279",R="425066",C={tiles:[null],clickTiles:[],player:[],A2ZTile:{},ATB:{},item:{color:[O,"2a7",O,"fff","a84",O,"bcb","a00","216","216","297",...o(4,"fff"),"216","216"],count:[M,M,M,M,T,M,M,M,T,T,I,I,I,I,I,k,k],pattern:["pð¡Žé‰ˆé¥“ä¹’ð‘Ç€"," ï¿°ð¶€ð®»ð¸€·Ç¿"," ð¡¿€ðŸ°¿ð¼¸ð¿¿§ð¤¬¤á¤®","à¯¾ìœ˜ð—–‘ðµ««ð™„µÌœà¿º","ð˜™Ø€ð™ ™ð˜™€á¤†æ€˜á¤","é¿¿í‰™é‰é©‹ð™‰¹é‰á¿¿","ð•¿¿ð•ð•—•ð•µ—ð•µð••á¿¿","á¯¾íœç†‘ð±££ð™„±Ýà¿»","Ðð¡¿°ð”¤¤ð¤Œ¤ð²¤¤ð¤¡¥á”","ð¦„¤ð¡¥‚ð”¤ð”Œ˜â’„ð±¡‘Ñ","ð¬°ð±£ð§¤ë¦³ð¥…šÒ¾à¿¹","ð¾€€ðº‡ð¬¹“ð•ˆð¥»Šð¿¢","è‰È€è€ˆÈ€à ‚â€ˆá€¤","è€€Ì€ï¼Žð¿¾à¸ƒâ€Œ","ð €€à°€ð¿°¸ð¼¿¸ã è€°","ð¾€€ð‘¥±ê›¹ê„¤ð¿“ƒðŸ¡¥","ð¾€€ð‘©±ì«²ð’…Œð¿¥‚ðŸ¡©"]},font:{color1:o(40,"a78e44"),color2:o(40,"e29c45"),pattern:["","ð²…»ð›´‰","ð’¥Žä€‘","ä˜®ä€‘","ð­™®î³–","ð¡ƒ„îˆ","ð¤˜®ðŸ¢","ð¤˜®ðž£…","ðº”©è£","ð°˜®î£","ð¸˜®î£…","ð¢ˆŸäˆ","ð´˜¾î£…","ð´˜¾ð¡ƒ","ì®ð‘·¾","ð¼˜¯ï£…","è˜®î¢„","ì˜¯ï£†","ð¸˜¿ðŸ¢…","ð¸˜¿á‚…","ð¨˜®î£—","ð¼˜±ð‘£‡","ð¡‚Žîˆ","äˆì¥Š","ðº˜±ð‘¢¤","è¡ðŸ‚„","í±ð‘£†","í™±ð‘£‡","ì˜®î£†","ð¼˜®á‚…","ì˜®ðŸ³–","ð¼˜¯ð‘’•","ð°˜®î£","ð¡‚Ÿäˆ","ì˜±î£†","ì˜±ä•†","ì˜±ð‘·–","ð¢¨±ð‘¢¨","ð¢¨±äˆ","ð¢ˆ¿ðŸ¢ˆ"]}},A={mw:0,mh:0,mis:300,level:0,player:null,tap:0,emerge:0,dragRect:null,dragNumber:0,dragCount:2,background:null,trans:{s:0,st:null,e:0,et:null},UI:{controler:[0,0,0],view:[]},meunMaxWidth:250,meunMaxheight:150,meunItemLenth:24,gm:[],dragMax:[],gameObject:[],dragObject:[],clickObject:[],historyMap:[],currentMap:[],RME:function(t){return this.UI.controler=[...t],[...t]},get gameStart(){return this.UI.controler.find((t=>1==t))},get fadeIn(){return this.trans.s=1,this.trans.e=0,1},get fadeOut(){return this.trans.s=0,this.trans.e=1,0},get cw(){return this.mw/2},get ch(){return this.mh/2},get mwl(){let t=0;return this.currentMap.forEach((e=>{t=s(t,e.length)})),t},get mhl(){return this.currentMap.length},get grid(){let t=e(this.mw,this.mh),i=s(this.mwl,this.mhl)+3;return e(this.mis,t/i)},get gwh(){return{x:this.grid,y:this.grid}},get menuItemSize(){return{x:e(this.meunMaxWidth,1.5*this.grid),y:e(this.meunMaxheight,this.ch/(this.meunItemLenth/4))}},get CurPos(){return{x:this.cw-this.mwl*this.grid/2,y:this.ch-this.mhl*this.grid/2}},get maxLgth(){return{x:this.mwl,y:this.mhl}}},P=({x:t,y:s,w:e,h:i},h=1,r=0,o=5)=>{w.beginPath(),w.moveTo(t+o,s),w.lineTo(t+e-o,s),w.quadraticCurveTo(t+e,s,t+e,s+o),w.lineTo(t+e,s+i-o),w.quadraticCurveTo(t+e,s+i,t+e-o,s+i),w.lineTo(t+o,s+i),w.quadraticCurveTo(t,s+i,t,s+i-o),w.lineTo(t,s+o),w.quadraticCurveTo(t,s,t+o,s),w.closePath(),h&&w.fill(),r&&w.stroke()},j=(t,s,e,i,h=0)=>{let r=((t,s,e)=>Array.from({length:e},((e,i)=>t.slice(i*s,(i+1)*s))))(((t,s,e)=>{let i=[];return[...t].forEach((t=>{let s=t.codePointAt(0);for(let t=0;t<18;t++)i.push(1&s),s>>=1})),i.slice(0,e)})(t,0,e*i),e,i);var o=l.createElement("canvas"),n=d(o);const a=16,c=e*a,p=i*a;o.width=c,o.height=p,n.clearRect(0,0,c,p);const g=(t,s)=>{[{r:!r[s][t-1],m:[0,0],l:[0,1]},{r:!r[s][t+1],m:[1,0],l:[1,1]},{r:!r[s-1]||!r[s-1][t],m:[0,0],l:[1,0]},{r:!r[s+1]||!r[s+1][t],m:[0,1],l:[1,1]}].forEach((e=>{e.r&&(n.beginPath(),n.lineWidth=5,n.strokeStyle="#ccc",n.moveTo((t+e.m[0])*a,(s+e.m[1])*a),n.lineTo((t+e.l[0])*a,(s+e.l[1])*a),n.stroke())}))};for(var w=0;w<i;w++)for(var y=0;y<e;y++)r[w][y]&&(n.fillStyle="#"+s,n.fillRect(y*a,w*a,a,a),h&&g(y,w));return new Promise((t=>{let s=u();s.src=m(o),s.onload=()=>t(s)}))},S=async(t,s,e=0)=>Object.fromEntries(await U(" %!?0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").map(((i,h)=>j(t[h],s[h],5,7,e).then((t=>[i,t])))))),H=(t,s)=>{var e=l.createElement("canvas"),i=d(e),h=t.width,r=t.height,o=s*Math.PI/180;return e.width=h,e.height=r,i.translate(h/2,r/2),i.rotate(o),i.drawImage(t,-h/2,-r/2),new Promise((t=>{let s=u();s.src=m(e),s.onload=()=>t(s)}))},U=async t=>await Promise.all(t);class D{constructor(t=0,s=0,e=0,i=0){this.x=t,this.y=s,this.h=i,this.w=e}set(t){return this.x=t.x,this.y=t.y,this}setwh(t,s){return this.w=s,this.h=s,this.set(t)}add(t){return this.x+=t.x,this.y+=t.y,this}equal(t){return this.x==t.x&&this.y==t.y}inside(t){return this.x<t.x&&this.y<t.y&&this.x>=0&&this.y>=0}zero(){this.x=this.y=0}substract(t){return this.x-=t.x,this.y-=t.y,this}dotwh(){return this.x*=this.w,this.y*=this.h,this}dot(t){return this.x*=t,this.y*=t,this}clone(){return new D(this.x,this.y,this.w,this.h)}}class z{constructor(t=1,s=1,e=1,i=0){this.startTime=t,this.endTime=s,this.step=e,this.loop=i}set(t,s,e){this.startTime=t,this.endTime=s,this.step=e}add(){this.startTime+=this.step}sub(){this.startTime-=this.step}reset(){this.startTime=0}start(){return this.startTime<this.endTime?(this.add(),0):(this.loop&&this.reset(),1)}get progress(){return e(this.startTime/this.endTime,1)}}class L{constructor(t){this.pill=[],this.connections=[],this.mainHue=i(360);for(let s=0;s<t;s++)this.pill.push({x:i(A.mw),y:i(A.mh),size:i(3)+2,speedX:i(1)-.5,speedY:i(1)-.5,hue:this.mainHue+i(60)-30})}update(t){this.pill.forEach((t=>{t.x+=t.speedX,t.y+=t.speedY,t.x<0&&(t.x=window.innerWidth),t.x>window.innerWidth&&(t.x=0),t.y<0&&(t.y=window.innerHeight),t.y>window.innerHeight&&(t.y=0),t.hue=this.mainHue+i(60)-30})),this.connects(t),this.draw()}draw(){w.save(),this.pill.forEach(((t,s)=>{w.beginPath(),w.arc(t.x,t.y,t.size,0,2*Math.PI),w.fillStyle="#bbb",w.fill()})),this.connections.forEach((t=>{const s=w.createLinearGradient(t.x1,t.y1,t.x2,t.y2);if(s.addColorStop(0,`hsla(${t.hue}, 70%, 60%, ${.5*t.alpha})`),s.addColorStop(.3,`hsla(${t.hue}, 100%, 80%, ${t.alpha})`),s.addColorStop(1,`hsla(${t.hue}, 70%, 60%, ${.5*t.alpha})`),w.beginPath(),w.moveTo(t.x1,t.y1),w.lineTo(t.x2,t.y2),w.strokeStyle=s,w.lineWidth=2*t.alpha,w.stroke(),i(1)<.05){w.beginPath(),w.moveTo(t.x1,t.y1);const s=(t.x1+t.x2)/2+i(20)*i(.5),e=(t.y1+t.y2)/2+i(20)*i(.5);w.quadraticCurveTo(s,e,t.x2,t.y2),w.strokeStyle=`hsla(${t.hue}, 100%, 80%, ${t.alpha})`,w.lineWidth=3*t.alpha,w.stroke()}})),w.restore()}connects(t){this.connections=[];let s=this.pill;for(let t=0;t<s.length;t++)for(let e=t+1;e<s.length;e++){const i=r(s[t],s[e]);i<100&&this.connections.push({x1:s[t].x,y1:s[t].y,x2:s[e].x,y2:s[e].y,alpha:1-i/100,hue:(s[t].hue+s[e].hue)/2})}}}class N{constructor(t,i=0,h=0){this.moveY=i,this.waveY=h,t=t.split("\n");let r=e(A.grid,50),o=0,n=A.ch-t.length*r/2;this.char=t.flatMap(((t,e)=>(o=s(o,t.length),t.split("").map(((t,s)=>({pos:new D(0,n+r*e*1.3,r,r),vpos:new D(e,s),c:t,size:r})))))),this.x=A.cw-r*o/2,this.pos=new D(this.x,n-r*s(this.waveY,2)/2,r*o,(r+15)*(t.length+s(this.waveY,1)))}update(t){v(),f(R),P(this.pos.clone().add({x:5,y:5}),1,0,15),f(E),P(this.pos,1,1,15),this.char.forEach(((t,s)=>{t.pos.y=t.pos.y+Math.sin(.01*Date.now()+s*this.moveY)*this.waveY,t.pos.x=this.x+t.size*t.vpos.y,y(C.A2ZTile[t.c],t.pos.clone().dot(1.01)),y(C.ATB[t.c],t.pos)})),b()}}class Y extends N{constructor(t){super(t),this.timer=new z(0,100),this.dtimer=new z(0,2,.01),this.reverse=1,this.trigger=0;let s=e(A.grid,50);this.x=A.cw-s*t.length/2,t=t.split("\n"),this.char=t.flatMap(((t,e)=>t.split("").map(((t,h)=>({pos:new D(i(A.mw),i(A.mh)),epos:new D(this.x+s*h,A.ch+s*e),spos:new D(i(A.mw),i(A.mh)),c:t,size:s,opacity:1}))))),this.rains=[];for(let t=0;t<50;t++)this.rains.push({x:i(A.mw),y:i(A.mh),length:i(20)+10,speed:i(5)+2,opacity:i(.5)+.2});this.rainDrops=[]}update(t){v(),this.rains.forEach((t=>{t.y+=t.speed,t.y>canvas.height&&(t.y=-t.length,t.x=Math.random()*canvas.width),w.strokeStyle=`rgba(255, 255, 255, ${t.opacity})`,w.lineWidth=2,w.beginPath(),w.moveTo(t.x,t.y),w.lineTo(t.x,t.y+t.length),w.stroke()}));let i=A.grid+15;this.reverse?(this.dtimer.add(),this.dtimer.progress>=.7&&(this.reverse=0)):(this.dtimer.sub(),this.dtimer.progress<0&&(this.reverse=1)),x(s(this.dtimer.progress,0)),((t,s,e,i,h,r="888")=>{v(),(t=>{w.strokeStyle="#"+t})(r),P({x:t,y:s,w:e,h:i},0,1),f(r),P({x:t+e+10,y:s+i/4,w:e/8,h:i/2},1),b()})(this.x,A.ch-i,3*i,i-15),f("e61c5d"),w.fillRect(0,0,A.mw,A.mh),b(),v(),f("880"),P({x:this.x,y:A.ch-i,w:i/4,h:i-15}),this.char.forEach(((t,i)=>{t.pos.setwh(t.pos,e(A.grid,50)),this.trigger?(t.pos.add(t.spos.clone().substract(t.pos).dot(.02)),t.opacity=s(t.opacity-=.01,0)):(t.pos.add(t.epos.clone().substract(t.pos).dot(.02)),t.opacity=Math.min(t.opacity,1)),x(t.opacity),y(C.A2ZTile[t.c],t.pos.clone().dot(1.13)),y(C.ATB[t.c],t.pos)})),b(),this.trigger&&this.timer.start()&&A.RME([0,1,0])}}class W{constructor(t,e=!1,i=3e3){this.foreground=t.pos,this.backgroundColor="#000",this.duration=i,this.timer=new z(0,i,32),this.maxRadius=s(g.width,g.height),this.minRadius=.5,this.isRunning=!0,this.fadeIn=e}update(){if(!this.isRunning)return;const t=this.timer.progress,s=(i=t)*(2-i);var i;let h;h=this.fadeIn?e(this.minRadius+s*(this.maxRadius-this.minRadius),this.maxRadius):this.maxRadius-s*(this.maxRadius-this.minRadius),w.save(),w.globalCompositeOperation="destination-in",w.beginPath(),w.arc(this.foreground.x+this.foreground.w/2,this.foreground.y+this.foreground.h/2,h,0,2*Math.PI),w.fill(),w.restore(),this.timer.add(),t>=1&&(this.isRunning=!1)}}class q{constructor(t,s,e,i,h,r=0){this.npos=new D(t,s,e,i),this.pos=this.npos.clone(),this.spos=this.pos.clone(),this.prevpos=this.pos.clone(),this.dtimer=new z(0,1,.05,1),this.pd=8,this.cd=7,this.kind=h,this.isDragging=r,this.timer=new z(0,1,.1),this.mapLength=A.maxLgth,this.color=["#000","#0f0","#f00","#00f","#0ff","#f0f","#fff","#f5f"][h]}update(t){this.draw()}draw(){}isMouseOver(t,s){return t>this.pos.x&&t<this.pos.x+this.pos.w&&s>this.pos.y&&s<this.pos.y+this.pos.h}resize(){this.spos=this.pos.clone(),this.prevpos=this.pos.clone()}}class B extends q{constructor(t,s,e,i,h,r=-1){super(t,s,e,i,h,r>=0?0:1),this.sh=0,this.ds=0,this.canDrag=0,this.clickAction=r,this.drawImg=-1==r?C.tiles:C.clickTiles}shift(t){if(this.ds)return;const{x:s,y:e}=A.CurPos;this.prevpos.x=s+this.pos.w+this.pos.w*t,this.pos.x=s+this.pos.w+this.pos.w*t}draw(){v(),y(this.drawImg[this.kind],this.pos),this.sh&&(x(.5),y(this.drawImg[this.kind],this.spos)),y(this.drawImg[this.kind],this.prevpos),b()}stopDragging(){this.pos=this.prevpos.clone(),this.spos=this.prevpos.clone(),this.sh&&this.npos.inside(this.mapLength)?(A.currentMap[this.npos.y][this.npos.x]=this.kind,A.dragObject=A.dragObject.filter((t=>t!=this))):(this.ds=0,this.pos=this.prevpos.clone(),this.spos=this.pos.clone())}drag(t,s){this.ds=1,this.isDragging&&(this.pos.x=t-this.pos.w/2,this.pos.y=s-this.pos.h/2,this.inGridMap())}inGridMap(){const t=A.CurPos,s=this.pos.clone().substract(t);s.x=h(s.x/s.w),s.y=h(s.y/s.h),s.inside(this.mapLength)?(0==A.currentMap[s.y][s.x]&&(this.spos.set(s.clone().dotwh().add(t)),this.npos.set(s)),this.sh=!0):this.sh=!1}}class $ extends q{constructor(t,s,e,i,h,r){super(t,s,e,i,h),this.show=1,this.player=r}update(t){this.player=t,this.pos=t.pos.clone().add(this.npos.clone().dot(t.pos.w)),this.draw()}draw(){v(),w.fillStyle="#888";{this.dtimer.start(),w.globalAlpha=.3;let t=4*(this.dtimer.progress>.5?0:1);y(C.clickTiles[this.kind+7+t],this.pos)}b()}}class G extends q{constructor(t,s,e,i,h){super(t,s,e,i,1),this.vpos=new D,this.ppos=new D,this.tap=h,this.kind=1,this.direction=1,this.mapping=[-3,3,2,-2].reduce(((t,s,e)=>(t[s]=e,t)),{}),console.log(this.mapping),this.mapping1=[1,-1,-2,2].reduce(((t,s,e)=>(t[s]=e,t)),{}),this.moving=0,this.arrowHint=[];const r=[0,0];this.arrows=[[1,0],[-1,0],[0,-1],[0,1]];const o=[...Array(5).fill(r),...this.arrows,...Array(6).fill(r)];this.moveset=o.map((([t,s])=>({x:t,y:s}))),this.arrows.forEach(((t,s)=>{this.arrowHint.push(new $(t[0],t[1],e,i,s+5,this))}))}update(t){let s=17;if(this.vpos.equal(this.moveset[0])&&this.direction>=9){if(this.tap<=0&&!this.moving)return A.trans.e||(A.trans.et=new W(this,A.fadeOut)),void(this.arrowHint=[]);0==this.tap&&(this.arrowHint=[]),this.arrowHint.forEach((t=>{const s=this.npos.clone().add(t.npos);s.inside(this.mapLength)?A.currentMap[s.y][s.x]<=8&&(t.show=1,t.update(this)):t.show=0}))}this.direction>=4&&this.direction<=8&&(this.vpos.set(this.moveset[this.direction]),this.direction>=5&&(this.cd=this.direction));const e=this.npos.clone();if(e.add(this.vpos),e.inside(this.mapLength)){if(!this.moving){const t=A.currentMap[e.y][e.x];t<=8?(this.ppos=this.npos.clone(),this.npos=e.clone(),this.moving=1):(11!=t&&16!=t&&18!=t||this.vpos.equal(this.moveset[0])||(this.tap=0),10==t&&(A.currentMap[e.y][e.x]=0),this.vpos.zero(),this.direction=9)}}else this.direction=9,this.vpos.zero();if(this.moving){const t=A.CurPos;this.prevpos.set(this.npos.clone().dot(this.pos.w)).add(t);const e=this.timer.progress;if(this.pos.add(this.prevpos.clone().substract(this.pos).dot(e)),this.pd==this.cd)s=this.cd<=6?18:16;else{let t=this.mapping[this.pd-this.cd];6!=this.pd&&6!=this.cd||(t=this.mapping1[this.pd-this.cd]),s=12+t}A.currentMap[this.ppos.y][this.ppos.x]=s||17,this.timer.start()&&(this.direction=A.currentMap[this.npos.y][this.npos.x],this.pd=this.cd,A.currentMap[this.npos.y][this.npos.x]=s||17,4==this.direction&&(A.currentMap=A.currentMap.map(((t,s)=>t.map(((t,e)=>{const i=p[A.level].map[s][e];return 4==i?0:i}))))),3==this.direction&&(A.currentMap=A.currentMap.map((t=>t.map((t=>9==t?0:t))))),2==this.direction&&(this.vpos.zero(),A.gm[A.level]||(A.emerge+=h(87/p.length),a("bt",+A.emerge)),A.gm[A.level]=1,a("gm",JSON.stringify(A.gm)),A.level++,A.trans.et=new W(this,A.fadeOut)),this.moving=0,this.timer.reset(),this.pos.set(this.prevpos))}}draw(){this.dtimer.start(),w.save();let t=4*(this.dtimer.progress>.5?0:1);f(E),x(.9),P(this.pos,10,0,0),y(C.player[this.cd-5+t],this.pos),w.restore()}resize(){const t=A.CurPos,s=A.grid;this.pos.setwh(this.npos.clone().dot(s).add(t),s)}}class X extends q{constructor(t,s,e,i,h){super(t,s,e,i,h),this.checked=!1,this.isHovered=!1}draw(){v();let t=E;A.gm[this.kind]&&(t="549688"),f(this.isHovered?"549688":R),P(this.pos.clone().add({x:5,y:5}),1,1),f(this.isHovered?"388E3C":t),P(this.pos,1,1,10);const e=this.pos.clone();e.w=this.pos.w/2,e.h=this.pos.h/2,e.x=this.pos.x+this.pos.w/4,e.y=this.pos.y+this.pos.h/4,y(C.tiles[s(1,this.kind%C.tiles.length)],e),b()}updateHover(t,s){this.isHovered=this.isMouseOver(t,s)}}class J{constructor(t){this.menuItems=[];const s=A.menuItemSize;t.forEach(((t,e)=>{const i=h(e/4),r=e%4,o=A.cw-2.2*s.x+r*s.x*1.2,n=A.ch-3.2*s.y+i*s.y*1.2;this.menuItems.push(new X(o,n,s.x,s.y,e))}))}update(t){this.menuItems.forEach((t=>t.draw()))}handleClick(t,s){this.menuItems.forEach((e=>{e.isMouseOver(t,s)&&(A.RME([0,0,0]),A.level=e.kind,A.trans.et=new W(A.player,A.fadeOut),A.trans.et.isRunning=0)}))}handleMouseMove(t,s){this.menuItems.forEach((e=>{e.updateHover(t,s)}))}}const Z=()=>{A.mw=g.width=window.innerWidth,A.mh=g.height=window.innerHeight,A.background=new L(100),A.UI.view[0]=new Y("13% LOW"),A.UI.view[1]=new J(p),A.UI.view[2]=new N(" THANK YOU!!\n FOR PLAYING \n GOOD DAY !!\n WANT MORE??\n LETS DEV !!",5,1,.8);const t=A.CurPos,s=A.grid;A.clickObject=[];for(let t=0;t<2;t++)A.clickObject.push(new B(10+1.2*s*t,20,s,s,t+4*t,t));[{x:s/10,y:-s,w:.8*s,h:.8*s,id:9,index:3},{x:s*(A.dragCount+1)+s/10,y:-s,w:.8*s,h:.8*s,id:8,index:4}].forEach((s=>{A.clickObject.push(new B(t.x+s.x,t.y+s.y,s.w,s.h,s.id,s.index))})),A.dragObject.forEach((e=>{e.pos.setwh(t,s).substract({x:0,y:1.1*s}),e.resize()})),A.gameObject.forEach((t=>{t.resize()}))},F=()=>{if(A.level>=p.length)return void A.RME([0,0,1]);A.gameObject=[],A.dragObject=[],A.clickObject=[];let{x:t,y:s}=A.CurPos;const e=A.grid,i=p[A.level];A.currentMap=JSON.parse(JSON.stringify(i.map)),A.dragCount=A.mwl-4,A.dragMax=i.dg,A.dragNumber=0,A.dragMax.forEach((i=>{const h=new B(t,s-1.1*e,e,e,i);A.dragObject.push(h)}));let h=i.map.flatMap(((t,s)=>t.map(((t,e)=>1===t?{i:s,j:e}:null)))).find((t=>t));A.player=new G(h.j,h.i,A.grid,A.grid,i.tap),A.tap=i.tap,A.gameObject.push(A.player),A.trans.st=new W(A.player,A.fadeIn),Z()},K=()=>{w.clearRect(0,0,A.mw,A.mh),A.UI.controler[0]||A.background.update(1),A.gameStart?A.UI.view.forEach(((t,s)=>{A.UI.controler[s]&&t.update(1)})):(((t,s,e,i)=>{let{x:h,y:r}=A.CurPos;v(),f(R),P({x:h+10,y:r+10,w:e*s+10,h:i*s+10},1,0,20),f(E),P({x:h,y:r,w:e*s+10,h:i*s+10},1,1,20);for(let e=0;e<t.length;e++)for(let i=0;i<t[e].length;i++)t[e][i]&&w.drawImage(C.tiles[t[e][i]],i*s+h,e*s+r,s,s);b(),A.gameObject.forEach((t=>{t.update(1),t.draw()}));const o=A.dragCount,n=A.dragObject.length>A.dragCount?A.dragNumber:0,a=n+o;A.dragObject.slice(n,a).forEach(((t,s)=>{t.canDrag=1,t.shift(s),t.draw()})),A.clickObject.forEach((t=>{t.draw(1)})),y(C.ATB[A.tap%10],{x:h+s*(A.dragCount+3)+s/10,y:r-s,w:.8*s,h:.8*s}),y(C.ATB[A.tap/10|0],{x:h+s*(A.dragCount+2)+s/10,y:r-s,w:.8*s,h:.8*s})})(A.currentMap,A.grid,A.mwl,A.mhl),A.trans.s&&(A.trans.st.update(),A.trans.st.isRunning||(A.trans.s=0)),A.trans.e&&(A.trans.et.update(),A.trans.et.isRunning||F())),requestAnimationFrame(K)};function V(t){if(t.clientX&&t.clientY)return{x:t.offsetX,y:t.offsetY};if(t.touches&&t.touches[0]){const s=g.getBoundingClientRect();return{x:t.touches[0].clientX-s.left,y:t.touches[0].clientY-s.top}}return{x:0,y:0}}function Q(t){t.preventDefault();const{x:e,y:i}=V(t);A.UI.controler[0]&&A.UI.view[0]&&(A.UI.view[0].trigger=1),A.UI.controler[1]&&A.UI.view[1]&&A.UI.view[1].handleClick(e,i),A.clickObject.forEach((t=>{t.isMouseOver(e,i)&&(1==t.clickAction&&F(),0==t.clickAction&&A.RME([1,0,0]),3==t.clickAction&&(A.dragNumber=Math.max(0,A.dragNumber-1)),4==t.clickAction&&(A.dragNumber=Math.min(Math.max(A.dragObject.length-A.dragCount,0),A.dragNumber+1)))})),A.dragObject.forEach((t=>{t.isDragging&&t.isMouseOver(e,i)&&t.canDrag&&(A.dragRect=t)})),A.player&&A.player.arrowHint.forEach((t=>{t.isMouseOver(e,i)&&t.show&&(A.player.direction=t.kind,A.player.cd=t.kind,A.player.tap-=1,A.tap=s(A.player.tap,0))}))}function _(t){t.preventDefault();const{x:s,y:e}=V(t);A.dragRect&&A.dragRect.drag(s,e),A.UI.controler[1]&&A.UI.view[1]&&A.UI.view[1].handleMouseMove(s,e)}function tt(){A.dragRect&&(A.dragRect.stopDragging(),A.dragRect=null)}(async()=>{await(async()=>{A.mw=g.width=window.innerWidth,A.mh=g.height=window.innerHeight;const t=c("bt"),s=c("gm");A.emerge=t?+t:13,A.gm=s?JSON.parse(s):o(p.length,0),C.A2ZTile=await S(C.font.pattern,C.font.color1),C.ATB=await S(C.font.pattern,C.font.color2,1);const e=await U(C.item.pattern.map(((t,s)=>j(t,C.item.color[s],11,11)))),i=[0,180,270,90],h=await U(i.map((t=>H(e[4],t))));return new Promise((async t=>{const s=e.map((async(t,s)=>{const e=C.item.count[s];if(e==M||4==s)4==s?C.tiles=C.tiles.concat(h):C.tiles.push(t);else{const s=await U(i.map((s=>H(t,s))));e==I&&(C.clickTiles=C.clickTiles.concat(s)),e==T&&(C.tiles=C.tiles.concat(s)),e==k&&(C.player=C.player.concat(s))}}));await U(s),t()}))})(),F(),K()})(),onresize=()=>Z(),g.onmousedown=t=>Q(t),g.onmousemove=t=>_(t),g.onmouseup=t=>tt(),g.onmouseleave=t=>tt(),g.ontouchstart=t=>Q(t),g.ontouchmove=t=>_(t),g.ontouchend=t=>tt(),g.ontouchcancel=t=>tt()})();